<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Deathroll Arena</title>

<script src="/socket.io/socket.io.js"></script>

<style>
  body {
    background-color: #0e0e0e;
    color: #f8f8f8;
    font-family: "Trebuchet MS", Arial, sans-serif;
    margin: 0;
    padding: 0;
  }

  #topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #1a1a1a;
    padding: 10px;
    border-bottom: 2px solid #333;
  }

  #title {
    font-size: 20px;
    font-weight: bold;
    color: #ff8000;
    text-shadow: 0 0 6px #000;
  }

  #controls {
    display: flex;
    gap: 8px;
  }

  button {
    background: #222;
    color: #f8f8f8;
    border: 1px solid #444;
    padding: 6px 10px;
    cursor: pointer;
  }

  button:hover {
    background: #333;
  }

  #gold {
    font-weight: bold;
    margin-left: 8px;
  }

  #chatbox {
    height: 420px;
    overflow-y: auto;
    padding: 10px;
    background: #0b0b0b;
    border-bottom: 2px solid #333;
    font-size: 14px;
  }

  .you { color: #ffffff; }
  .system { color: #ffd100; }
  .win { color: #1eff00; font-weight: bold; }
  .lose { color: #ff4040; font-weight: bold; }

  #inputbar {
    display: flex;
    padding: 10px;
    gap: 8px;
    background: #111;
  }

  input {
    flex: 1;
    background: #000;
    color: #fff;
    border: 1px solid #444;
    padding: 6px;
  }
</style>
</head>

<body>

<div id="topbar">
  <div id="title">Deathroll Arena</div>
  <div id="controls">
    <button onclick="queueUp()">Queue</button>
    <button onclick="begForGold()">Beg for Gold</button>
    <div id="gold">ðŸª™ 5000</div>
    <button onclick="location.href='/'">Return to Hub</button>
  </div>
</div>

<div id="chatbox"></div>

<div id="inputbar">
  <input id="chatInput" placeholder="Type /roll 1000 or chat..." />
  <button onclick="sendInput()">Send</button>
</div>

<script>
/* =======================
   EXISTING GOLD SYSTEM
   (unchanged)
======================= */

let gold = parseInt(localStorage.getItem("gold")) || 5000;
document.getElementById("gold").textContent = "ðŸª™ " + gold;

function saveGold() {
  localStorage.setItem("gold", gold);
}

function begForGold() {
  const roll = Math.random() * 100;
  let gained = 0;

  if (roll < 65) gained = 10;
  else if (roll < 85) gained = 100;
  else if (roll < 95) gained = 300;
  else gained = 1000;

  gold += gained;
  saveGold();
  updateGold();

  addLine(`You beg pitifully and receive ${gained} gold.`, "system");
}

function updateGold() {
  document.getElementById("gold").textContent = "ðŸª™ " + gold;
}

/* =======================
   CHAT / UI (unchanged)
======================= */

const chatbox = document.getElementById("chatbox");
const input = document.getElementById("chatInput");

function addLine(text, cls="you") {
  const div = document.createElement("div");
  div.className = cls;
  div.textContent = text;
  chatbox.appendChild(div);
  chatbox.scrollTop = chatbox.scrollHeight;
}

function sendInput() {
  const msg = input.value.trim();
  if (!msg) return;
  input.value = "";

  if (msg.startsWith("/roll")) {
    const parts = msg.split(" ");
    if (parts.length === 2) {
      const max = parseInt(parts[1]);
      if (!isNaN(max)) {
        socket.emit("roll", max);
      }
    }
    return;
  }

  socket.emit("chat", msg);
}

/* =======================
   MULTIPLAYER ADDITIONS
======================= */

const socket = io();

function queueUp() {
  socket.emit("queue");
  addLine("You queue for a deathroll match.", "system");
}

socket.on("chat", msg => {
  addLine(msg, "you");
});

socket.on("system", msg => {
  addLine(msg, "system");
});

/* optional */
input.addEventListener("keypress", e => {
  if (e.key === "Enter") sendInput();
});
</script>

</body>
</html>
